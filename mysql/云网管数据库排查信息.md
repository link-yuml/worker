# **云网管数据库数据库现状** 	

云网管现在单库单表，一共一个库，目前共有372张表。采用hibernate的连接进行数据连接管理，连接池配置采用的为hibernate默认配置，其中修改了以下选项：

```xml
            <property name="maxActive" value="500" />
            <property name="maxWait" value="1000" />
            <property name="poolPreparedStatements" value="true" />
            <property name="defaultAutoCommit" value="false" />
            
            MaxActive，连接池的最大数据库连接数。
            maxWait:最大等待毫秒数。
            poolPreparedStatements 是否缓存preparedStatement，也就是PSCache。 
            defaultAutoCommit hibernate是否自动提交。false代表hibernate不自动提交，事务由spring控制
            
```


```
mysql> show global status;
+------------------------------------------+----------------+
| Variable_name                            | Value          |
+------------------------------------------+----------------+
| Aborted_clients                          | 1661           |
| Aborted_connects                         | 39             |
| Binlog_cache_disk_use                    | 290            |
| Binlog_cache_use                         | 7565436        |
| Binlog_stmt_cache_disk_use               | 883            |
| Binlog_stmt_cache_use                    | 367818         |
| Bytes_received                           | 1815264879561  |
| Bytes_sent                               | 9293676641309  |
| Com_admin_commands                       | 35962          |
| Com_assign_to_keycache                   | 0              |
| Com_alter_db                             | 0              |
| Com_alter_db_upgrade                     | 0              |
| Com_alter_event                          | 0              |
| Com_alter_function                       | 0              |
| Com_alter_procedure                      | 0              |
| Com_alter_server                         | 0              |
| Com_alter_table                          | 15             |
| Com_alter_tablespace                     | 0              |
| Com_analyze                              | 0              |
| Com_begin                                | 65             |
| Com_binlog                               | 0              |
| Com_call_procedure                       | 5295           |
| Com_change_db                            | 24738          |
| Com_change_master                        | 0              |
| Com_check                                | 0              |
| Com_checksum                             | 0              |
| Com_commit                               | 222704703      |
| Com_create_db                            | 0              |
| Com_create_event                         | 0              |
| Com_create_function                      | 0              |
| Com_create_index                         | 0              |
| Com_create_procedure                     | 4              |
| Com_create_server                        | 0              |
| Com_create_table                         | 547            |
| Com_create_trigger                       | 0              |
| Com_create_udf                           | 0              |
| Com_create_user                          | 0              |
| Com_create_view                          | 3              |
| Com_dealloc_sql                          | 3968           |
| Com_delete                               | 11798          |
| Com_delete_multi                         | 0              |
| Com_do                                   | 0              |
| Com_drop_db                              | 0              |
| Com_drop_event                           | 0              |
| Com_drop_function                        | 0              |
| Com_drop_index                           | 0              |
| Com_drop_procedure                       | 5              |
| Com_drop_server                          | 0              |
| Com_drop_table                           | 861            |
| Com_drop_trigger                         | 0              |
| Com_drop_user                            | 0              |
| Com_drop_view                            | 0              |
| Com_empty_query                          | 0              |
| Com_execute_sql                          | 3968           |
| Com_flush                                | 0              |
| Com_grant                                | 0              |
| Com_ha_close                             | 0              |
| Com_ha_open                              | 0              |
| Com_ha_read                              | 0              |
| Com_help                                 | 0              |
| Com_insert                               | 2646974        |
| Com_insert_select                        | 8407           |
| Com_install_plugin                       | 0              |
| Com_kill                                 | 10             |
| Com_load                                 | 65             |
| Com_lock_tables                          | 0              |
| Com_optimize                             | 0              |
| Com_preload_keys                         | 0              |
| Com_prepare_sql                          | 3968           |
| Com_purge                                | 0              |
| Com_purge_before_date                    | 0              |
| Com_release_savepoint                    | 0              |
| Com_rename_table                         | 1              |
| Com_rename_user                          | 0              |
| Com_repair                               | 0              |
| Com_replace                              | 0              |
| Com_replace_select                       | 13             |
| Com_reset                                | 65             |
| Com_resignal                             | 0              |
| Com_revoke                               | 0              |
| Com_revoke_all                           | 0              |
| Com_rollback                             | 222994511      |
| Com_rollback_to_savepoint                | 0              |
| Com_savepoint                            | 0              |
| Com_select                               | 3129732972     |
| Com_set_option                           | 446971246      |
| Com_signal                               | 0              |
| Com_show_authors                         | 0              |
| Com_show_binlog_events                   | 0              |
| Com_show_binlogs                         | 0              |
| Com_show_charsets                        | 3283           |
| Com_show_collations                      | 200687         |
| Com_show_contributors                    | 0              |
| Com_show_create_db                       | 3              |
| Com_show_create_event                    | 0              |
| Com_show_create_func                     | 553            |
| Com_show_create_proc                     | 5819           |
| Com_show_create_table                    | 132779         |
| Com_show_create_trigger                  | 0              |
| Com_show_databases                       | 284            |
| Com_show_engine_logs                     | 0              |
| Com_show_engine_mutex                    | 0              |
| Com_show_engine_status                   | 0              |
| Com_show_events                          | 0              |
| Com_show_errors                          | 0              |
| Com_show_fields                          | 30294          |
| Com_show_function_status                 | 24             |
| Com_show_grants                          | 0              |
| Com_show_keys                            | 3448           |
| Com_show_master_status                   | 0              |
| Com_show_open_tables                     | 1              |
| Com_show_plugins                         | 0              |
| Com_show_privileges                      | 0              |
| Com_show_procedure_status                | 24             |
| Com_show_processlist                     | 6              |
| Com_show_profile                         | 0              |
| Com_show_profiles                        | 1323           |
| Com_show_relaylog_events                 | 0              |
| Com_show_slave_hosts                     | 0              |
| Com_show_slave_status                    | 0              |
| Com_show_status                          | 3576           |
| Com_show_storage_engines                 | 13             |
| Com_show_table_status                    | 24246          |
| Com_show_tables                          | 4714           |
| Com_show_triggers                        | 24995          |
| Com_show_variables                       | 200824         |
| Com_show_warnings                        | 980            |
| Com_slave_start                          | 0              |
| Com_slave_stop                           | 0              |
| Com_stmt_close                           | 3968           |
| Com_stmt_execute                         | 3968           |
| Com_stmt_fetch                           | 0              |
| Com_stmt_prepare                         | 3968           |
| Com_stmt_reprepare                       | 0              |
| Com_stmt_reset                           | 0              |
| Com_stmt_send_long_data                  | 0              |
| Com_truncate                             | 3331           |
| Com_uninstall_plugin                     | 0              |
| Com_unlock_tables                        | 65             |
| Com_update                               | 9961896        |
| Com_update_multi                         | 1827           |
| Com_xa_commit                            | 0              |
| Com_xa_end                               | 0              |
| Com_xa_prepare                           | 0              |
| Com_xa_recover                           | 0              |
| Com_xa_rollback                          | 0              |
| Com_xa_start                             | 0              |
| Compression                              | OFF            |
| Connections                              | 201444         |
| Created_tmp_disk_tables                  | 59134          |
| Created_tmp_files                        | 58823          |
| Created_tmp_tables                       | 2360278        |
| Delayed_errors                           | 0              |
| Delayed_insert_threads                   | 0              |
| Delayed_writes                           | 0              |
| Flush_commands                           | 1              |
| Handler_commit                           | 2031486541     |
| Handler_delete                           | 45162157       |
| Handler_discover                         | 0              |
| Handler_prepare                          | 39534298       |
| Handler_read_first                       | 106350723      |
| Handler_read_key                         | 13550928152    |
| Handler_read_last                        | 2847826        |
| Handler_read_next                        | 529565982724   |
| Handler_read_prev                        | 8775970967     |
| Handler_read_rnd                         | 2954224483     |
| Handler_read_rnd_next                    | 5799495840371  |
| Handler_rollback                         | 550586         |
| Handler_savepoint                        | 0              |
| Handler_savepoint_rollback               | 0              |
| Handler_update                           | 6724542289     |
| Handler_write                            | 15905654423    |
| Innodb_buffer_pool_pages_data            | 194051         |
| Innodb_buffer_pool_pages_dirty           | 0              |
| Innodb_buffer_pool_pages_flushed         | 595426295      |
| Innodb_buffer_pool_pages_free            | 4              |
| Innodb_buffer_pool_pages_misc            | 2550           |
| Innodb_buffer_pool_pages_total           | 196605         |
| Innodb_buffer_pool_read_ahead            | 239896         |
| Innodb_buffer_pool_read_ahead_evicted    | 10082          |
| Innodb_buffer_pool_read_requests         | 1978179777443  |
| Innodb_buffer_pool_reads                 | 487795         |
| Innodb_buffer_pool_wait_free             | 0              |
| Innodb_buffer_pool_write_requests        | 6801037626     |
| Innodb_data_fsyncs                       | 38778009       |
| Innodb_data_pending_fsyncs               | 0              |
| Innodb_data_pending_reads                | 0              |
| Innodb_data_pending_writes               | 0              |
| Innodb_data_read                         | 11946119168    |
| Innodb_data_reads                        | 729827         |
| Innodb_data_writes                       | 326514203      |
| Innodb_data_written                      | 10124355998208 |
| Innodb_dblwr_pages_written               | 297713197      |
| Innodb_dblwr_writes                      | 10094387       |
| Innodb_have_atomic_builtins              | ON             |
| Innodb_log_waits                         | 47             |
| Innodb_log_write_requests                | 705964784      |
| Innodb_log_writes                        | 16444909       |
| Innodb_os_log_fsyncs                     | 16967532       |
| Innodb_os_log_pending_fsyncs             | 0              |
| Innodb_os_log_pending_writes             | 0              |
| Innodb_os_log_written                    | 368559609856   |
| Innodb_page_size                         | 16384          |
| Innodb_pages_created                     | 4115592        |
| Innodb_pages_read                        | 728999         |
| Innodb_pages_written                     | 297713197      |
| Innodb_row_lock_current_waits            | 0              |
| Innodb_row_lock_time                     | 24387945       |
| Innodb_row_lock_time_avg                 | 335            |
| Innodb_row_lock_time_max                 | 51926          |
| Innodb_row_lock_waits                    | 72606          |
| Innodb_rows_deleted                      | 2616614        |
| Innodb_rows_inserted                     | 4367596        |
| Innodb_rows_read                         | 2364876457155  |
| Innodb_rows_updated                      | 3311810657     |
| Innodb_truncated_status_writes           | 0              |
| Key_blocks_not_flushed                   | 0              |
| Key_blocks_unused                        | 390216         |
| Key_blocks_used                          | 327195         |
| Key_read_requests                        | 22852060632    |
| Key_reads                                | 17620692       |
| Key_write_requests                       | 2463166983     |
| Key_writes                               | 1149684467     |
| Last_query_cost                          | 0.000000       |
| Max_used_connections                     | 261            |
| Not_flushed_delayed_rows                 | 0              |
| Open_files                               | 78             |
| Open_streams                             | 0              |
| Open_table_definitions                   | 400            |
| Open_tables                              | 256            |
| Opened_files                             | 758576         |
| Opened_table_definitions                 | 102764         |
| Opened_tables                            | 161821         |
| Performance_schema_cond_classes_lost     | 0              |
| Performance_schema_cond_instances_lost   | 0              |
| Performance_schema_file_classes_lost     | 0              |
| Performance_schema_file_handles_lost     | 0              |
| Performance_schema_file_instances_lost   | 0              |
| Performance_schema_locker_lost           | 0              |
| Performance_schema_mutex_classes_lost    | 0              |
| Performance_schema_mutex_instances_lost  | 0              |
| Performance_schema_rwlock_classes_lost   | 0              |
| Performance_schema_rwlock_instances_lost | 0              |
| Performance_schema_table_handles_lost    | 0              |
| Performance_schema_table_instances_lost  | 0              |
| Performance_schema_thread_classes_lost   | 0              |
| Performance_schema_thread_instances_lost | 0              |
| Prepared_stmt_count                      | 0              |
| Qcache_free_blocks                       | 950            |
| Qcache_free_memory                       | 3383736        |
| Qcache_hits                              | 277529272      |
| Qcache_inserts                           | 2766555736     |
| Qcache_lowmem_prunes                     | 2710188780     |
| Qcache_not_cached                        | 363164584      |
| Qcache_queries_in_cache                  | 7446           |
| Qcache_total_blocks                      | 15965          |
| Queries                                  | 4314406204     |
| Questions                                | 4313340362     |
| Rpl_status                               | AUTH_MASTER    |
| Select_full_join                         | 539446         |
| Select_full_range_join                   | 21             |
| Select_range                             | 6798403        |
| Select_range_check                       | 0              |
| Select_scan                              | 36643715       |
| Slave_heartbeat_period                   | 0.000          |
| Slave_open_temp_tables                   | 0              |
| Slave_received_heartbeats                | 0              |
| Slave_retried_transactions               | 0              |
| Slave_running                            | OFF            |
| Slow_launch_threads                      | 0              |
| Slow_queries                             | 6848           |
| Sort_merge_passes                        | 54537          |
| Sort_range                               | 15864921       |
| Sort_rows                                | 9595317908     |
| Sort_scan                                | 798332         |
| Table_locks_immediate                    | 3155005714     |
| Table_locks_waited                       | 1647           |
| Tc_log_max_pages_used                    | 0              |
| Tc_log_page_size                         | 0              |
| Tc_log_page_waits                        | 0              |
| Threads_cached                           | 1              |
| Threads_connected                        | 66             |
| Threads_created                          | 14165          |
| Threads_running                          | 1              |
| Uptime                                   | 5591939        |
| Uptime_since_flush_status                | 5591939        |
+------------------------------------------+----------------+
286 rows in set (0.01 sec)

mysql> show variables;
+---------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
| Variable_name                                     | Value                                                                                                                  |
+---------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
| auto_increment_increment                          | 2                                                                                                                      |
| auto_increment_offset                             | 1                                                                                                                      |
| autocommit                                        | ON                                                                                                                     |
| automatic_sp_privileges                           | ON                                                                                                                     |
| back_log                                          | 50                                                                                                                     |
| basedir                                           | /home/mysql                                                                                                            |
| big_tables                                        | OFF                                                                                                                    |
| binlog_cache_size                                 | 32768                                                                                                                  |
| binlog_direct_non_transactional_updates           | OFF                                                                                                                    |
| binlog_format                                     | MIXED                                                                                                                  |
| binlog_stmt_cache_size                            | 32768                                                                                                                  |
| bulk_insert_buffer_size                           | 67108864                                                                                                               |
| character_set_client                              | utf8                                                                                                                   |
| character_set_connection                          | utf8                                                                                                                   |
| character_set_database                            | gbk                                                                                                                    |
| character_set_filesystem                          | binary                                                                                                                 |
| character_set_results                             | utf8                                                                                                                   |
| character_set_server                              | gbk                                                                                                                    |
| character_set_system                              | utf8                                                                                                                   |
| character_sets_dir                                | /home/mysql/share/charsets/                                                                                            |
| collation_connection                              | utf8_general_ci                                                                                                        |
| collation_database                                | gbk_chinese_ci                                                                                                         |
| collation_server                                  | gbk_chinese_ci                                                                                                         |
| completion_type                                   | NO_CHAIN                                                                                                               |
| concurrent_insert                                 | AUTO                                                                                                                   |
| connect_timeout                                   | 10                                                                                                                     |
| datadir                                           | /home/mysql/data/                                                                                                      |
| date_format                                       | %Y-%m-%d                                                                                                               |
| datetime_format                                   | %Y-%m-%d %H:%i:%s                                                                                                      |
| default_storage_engine                            | InnoDB                                                                                                                 |
| default_week_format                               | 0                                                                                                                      |
| delay_key_write                                   | ON                                                                                                                     |
| delayed_insert_limit                              | 100                                                                                                                    |
| delayed_insert_timeout                            | 300                                                                                                                    |
| delayed_queue_size                                | 1000                                                                                                                   |
| div_precision_increment                           | 4                                                                                                                      |
| engine_condition_pushdown                         | ON                                                                                                                     |
| error_count                                       | 0                                                                                                                      |
| event_scheduler                                   | OFF                                                                                                                    |
| expire_logs_days                                  | 0                                                                                                                      |
| external_user                                     |                                                                                                                        |
| flush                                             | OFF                                                                                                                    |
| flush_time                                        | 0                                                                                                                      |
| foreign_key_checks                                | ON                                                                                                                     |
| ft_boolean_syntax                                 | + -><()~*:""&|                                                                                                         |
| ft_max_word_len                                   | 84                                                                                                                     |
| ft_min_word_len                                   | 4                                                                                                                      |
| ft_query_expansion_limit                          | 20                                                                                                                     |
| ft_stopword_file                                  | (built-in)                                                                                                             |
| general_log                                       | OFF                                                                                                                    |
| general_log_file                                  | /home/mysql/data/csmp-db2.log                                                                                          |
| group_concat_max_len                              | 1024                                                                                                                   |
| have_compress                                     | YES                                                                                                                    |
| have_crypt                                        | YES                                                                                                                    |
| have_csv                                          | YES                                                                                                                    |
| have_dynamic_loading                              | YES                                                                                                                    |
| have_geometry                                     | YES                                                                                                                    |
| have_innodb                                       | YES                                                                                                                    |
| have_ndbcluster                                   | NO                                                                                                                     |
| have_openssl                                      | NO                                                                                                                     |
| have_partitioning                                 | YES                                                                                                                    |
| have_profiling                                    | YES                                                                                                                    |
| have_query_cache                                  | YES                                                                                                                    |
| have_rtree_keys                                   | YES                                                                                                                    |
| have_ssl                                          | NO                                                                                                                     |
| have_symlink                                      | YES                                                                                                                    |
| hostname                                          | csmp-db2                                                                                                               |
| identity                                          | 0                                                                                                                      |
| ignore_builtin_innodb                             | OFF                                                                                                                    |
| init_connect                                      |                                                                                                                        |
| init_file                                         |                                                                                                                        |
| init_slave                                        |                                                                                                                        |
| innodb_adaptive_flushing                          | ON                                                                                                                     |
| innodb_adaptive_hash_index                        | ON                                                                                                                     |
| innodb_additional_mem_pool_size                   | 8388608                                                                                                                |
| innodb_autoextend_increment                       | 8                                                                                                                      |
| innodb_autoinc_lock_mode                          | 1                                                                                                                      |
| innodb_buffer_pool_instances                      | 3                                                                                                                      |
| innodb_buffer_pool_size                           | 3221225472                                                                                                             |
| innodb_change_buffering                           | all                                                                                                                    |
| innodb_checksums                                  | ON                                                                                                                     |
| innodb_commit_concurrency                         | 0                                                                                                                      |
| innodb_concurrency_tickets                        | 500                                                                                                                    |
| innodb_data_file_path                             | ibdata1:10M:autoextend                                                                                                 |
| innodb_data_home_dir                              |                                                                                                                        |
| innodb_doublewrite                                | ON                                                                                                                     |
| innodb_fast_shutdown                              | 1                                                                                                                      |
| innodb_file_format                                | Barracuda                                                                                                              |
| innodb_file_format_check                          | ON                                                                                                                     |
| innodb_file_format_max                            | Antelope                                                                                                               |
| innodb_file_per_table                             | ON                                                                                                                     |
| innodb_flush_log_at_trx_commit                    | 1                                                                                                                      |
| innodb_flush_method                               |                                                                                                                        |
| innodb_force_recovery                             | 0                                                                                                                      |
| innodb_io_capacity                                | 400                                                                                                                    |
| innodb_lock_wait_timeout                          | 50                                                                                                                     |
| innodb_locks_unsafe_for_binlog                    | OFF                                                                                                                    |
| innodb_log_buffer_size                            | 4194304                                                                                                                |
| innodb_log_file_size                              | 5242880                                                                                                                |
| innodb_log_files_in_group                         | 2                                                                                                                      |
| innodb_log_group_home_dir                         | ./                                                                                                                     |
| innodb_max_dirty_pages_pct                        | 75                                                                                                                     |
| innodb_max_purge_lag                              | 0                                                                                                                      |
| innodb_mirrored_log_groups                        | 1                                                                                                                      |
| innodb_old_blocks_pct                             | 37                                                                                                                     |
| innodb_old_blocks_time                            | 0                                                                                                                      |
| innodb_open_files                                 | 300                                                                                                                    |
| innodb_purge_batch_size                           | 20                                                                                                                     |
| innodb_purge_threads                              | 1                                                                                                                      |
| innodb_read_ahead_threshold                       | 56                                                                                                                     |
| innodb_read_io_threads                            | 8                                                                                                                      |
| innodb_replication_delay                          | 0                                                                                                                      |
| innodb_rollback_on_timeout                        | OFF                                                                                                                    |
| innodb_rollback_segments                          | 128                                                                                                                    |
| innodb_spin_wait_delay                            | 6                                                                                                                      |
| innodb_stats_method                               | nulls_equal                                                                                                            |
| innodb_stats_on_metadata                          | ON                                                                                                                     |
| innodb_stats_sample_pages                         | 8                                                                                                                      |
| innodb_strict_mode                                | OFF                                                                                                                    |
| innodb_support_xa                                 | ON                                                                                                                     |
| innodb_sync_spin_loops                            | 30                                                                                                                     |
| innodb_table_locks                                | ON                                                                                                                     |
| innodb_thread_concurrency                         | 9                                                                                                                      |
| innodb_thread_sleep_delay                         | 10000                                                                                                                  |
| innodb_use_native_aio                             | ON                                                                                                                     |
| innodb_use_sys_malloc                             | ON                                                                                                                     |
| innodb_version                                    | 1.1.6                                                                                                                  |
| innodb_write_io_threads                           | 8                                                                                                                      |
| insert_id                                         | 0                                                                                                                      |
| interactive_timeout                               | 28800                                                                                                                  |
| join_buffer_size                                  | 131072                                                                                                                 |
| keep_files_on_create                              | OFF                                                                                                                    |
| key_buffer_size                                   | 536870912                                                                                                              |
| key_cache_age_threshold                           | 300                                                                                                                    |
| key_cache_block_size                              | 1024                                                                                                                   |
| key_cache_division_limit                          | 100                                                                                                                    |
| large_files_support                               | ON                                                                                                                     |
| large_page_size                                   | 0                                                                                                                      |
| large_pages                                       | OFF                                                                                                                    |
| last_insert_id                                    | 0                                                                                                                      |
| lc_messages                                       | en_US                                                                                                                  |
| lc_messages_dir                                   | /home/mysql/share/                                                                                                     |
| lc_time_names                                     | en_US                                                                                                                  |
| license                                           | GPL                                                                                                                    |
| local_infile                                      | ON                                                                                                                     |
| lock_wait_timeout                                 | 31536000                                                                                                               |
| locked_in_memory                                  | OFF                                                                                                                    |
| log                                               | OFF                                                                                                                    |
| log_bin                                           | ON                                                                                                                     |
| log_bin_trust_function_creators                   | OFF                                                                                                                    |
| log_error                                         | /home/mysql/data/csmp-db2.err                                                                                          |
| log_output                                        | FILE                                                                                                                   |
| log_queries_not_using_indexes                     | OFF                                                                                                                    |
| log_slave_updates                                 | OFF                                                                                                                    |
| log_slow_queries                                  | OFF                                                                                                                    |
| log_warnings                                      | 1                                                                                                                      |
| long_query_time                                   | 10.000000                                                                                                              |
| low_priority_updates                              | OFF                                                                                                                    |
| lower_case_file_system                            | OFF                                                                                                                    |
| lower_case_table_names                            | 0                                                                                                                      |
| max_allowed_packet                                | 1048576                                                                                                                |
| max_binlog_cache_size                             | 18446744073709547520                                                                                                   |
| max_binlog_size                                   | 1073741824                                                                                                             |
| max_binlog_stmt_cache_size                        | 18446744073709547520                                                                                                   |
| max_connect_errors                                | 10                                                                                                                     |
| max_connections                                   | 1000                                                                                                                   |
| max_delayed_threads                               | 20                                                                                                                     |
| max_error_count                                   | 64                                                                                                                     |
| max_heap_table_size                               | 536870912                                                                                                              |
| max_insert_delayed_threads                        | 20                                                                                                                     |
| max_join_size                                     | 18446744073709551615                                                                                                   |
| max_length_for_sort_data                          | 1024                                                                                                                   |
| max_long_data_size                                | 1048576                                                                                                                |
| max_prepared_stmt_count                           | 16382                                                                                                                  |
| max_relay_log_size                                | 0                                                                                                                      |
| max_seeks_for_key                                 | 18446744073709551615                                                                                                   |
| max_sort_length                                   | 1024                                                                                                                   |
| max_sp_recursion_depth                            | 0                                                                                                                      |
| max_tmp_tables                                    | 32                                                                                                                     |
| max_user_connections                              | 0                                                                                                                      |
| max_write_lock_count                              | 18446744073709551615                                                                                                   |
| min_examined_row_limit                            | 0                                                                                                                      |
| multi_range_count                                 | 256                                                                                                                    |
| myisam_data_pointer_size                          | 6                                                                                                                      |
| myisam_max_sort_file_size                         | 9223372036853727232                                                                                                    |
| myisam_mmap_size                                  | 18446744073709551615                                                                                                   |
| myisam_recover_options                            | OFF                                                                                                                    |
| myisam_repair_threads                             | 1                                                                                                                      |
| myisam_sort_buffer_size                           | 67108864                                                                                                               |
| myisam_stats_method                               | nulls_unequal                                                                                                          |
| myisam_use_mmap                                   | OFF                                                                                                                    |
| net_buffer_length                                 | 16384                                                                                                                  |
| net_read_timeout                                  | 30                                                                                                                     |
| net_retry_count                                   | 10                                                                                                                     |
| net_write_timeout                                 | 60                                                                                                                     |
| new                                               | OFF                                                                                                                    |
| old                                               | OFF                                                                                                                    |
| old_alter_table                                   | OFF                                                                                                                    |
| old_passwords                                     | OFF                                                                                                                    |
| open_files_limit                                  | 8192                                                                                                                   |
| optimizer_prune_level                             | 1                                                                                                                      |
| optimizer_search_depth                            | 62                                                                                                                     |
| optimizer_switch                                  | index_merge=on,index_merge_union=on,index_merge_sort_union=on,index_merge_intersection=on,engine_condition_pushdown=on |
| performance_schema                                | OFF                                                                                                                    |
| performance_schema_events_waits_history_long_size | 10000                                                                                                                  |
| performance_schema_events_waits_history_size      | 10                                                                                                                     |
| performance_schema_max_cond_classes               | 80                                                                                                                     |
| performance_schema_max_cond_instances             | 1000                                                                                                                   |
| performance_schema_max_file_classes               | 50                                                                                                                     |
| performance_schema_max_file_handles               | 32768                                                                                                                  |
| performance_schema_max_file_instances             | 10000                                                                                                                  |
| performance_schema_max_mutex_classes              | 200                                                                                                                    |
| performance_schema_max_mutex_instances            | 1000000                                                                                                                |
| performance_schema_max_rwlock_classes             | 30                                                                                                                     |
| performance_schema_max_rwlock_instances           | 1000000                                                                                                                |
| performance_schema_max_table_handles              | 100000                                                                                                                 |
| performance_schema_max_table_instances            | 50000                                                                                                                  |
| performance_schema_max_thread_classes             | 50                                                                                                                     |
| performance_schema_max_thread_instances           | 1000                                                                                                                   |
| pid_file                                          | /home/mysql/data/csmp-db2.pid                                                                                          |
| plugin_dir                                        | /home/mysql/lib/plugin                                                                                                 |
| port                                              | 3306                                                                                                                   |
| preload_buffer_size                               | 32768                                                                                                                  |
| profiling                                         | OFF                                                                                                                    |
| profiling_history_size                            | 15                                                                                                                     |
| protocol_version                                  | 10                                                                                                                     |
| proxy_user                                        |                                                                                                                        |
| pseudo_thread_id                                  | 201443                                                                                                                 |
| query_alloc_block_size                            | 8192                                                                                                                   |
| query_cache_limit                                 | 10485760                                                                                                               |
| query_cache_min_res_unit                          | 4096                                                                                                                   |
| query_cache_size                                  | 16777216                                                                                                               |
| query_cache_type                                  | ON                                                                                                                     |
| query_cache_wlock_invalidate                      | OFF                                                                                                                    |
| query_prealloc_size                               | 8192                                                                                                                   |
| rand_seed1                                        | 0                                                                                                                      |
| rand_seed2                                        | 0                                                                                                                      |
| range_alloc_block_size                            | 4096                                                                                                                   |
| read_buffer_size                                  | 1048576                                                                                                                |
| read_only                                         | OFF                                                                                                                    |
| read_rnd_buffer_size                              | 4194304                                                                                                                |
| relay_log                                         |                                                                                                                        |
| relay_log_index                                   |                                                                                                                        |
| relay_log_info_file                               | relay-log.info                                                                                                         |
| relay_log_purge                                   | ON                                                                                                                     |
| relay_log_recovery                                | OFF                                                                                                                    |
| relay_log_space_limit                             | 0                                                                                                                      |
| report_host                                       |                                                                                                                        |
| report_password                                   |                                                                                                                        |
| report_port                                       | 3306                                                                                                                   |
| report_user                                       |                                                                                                                        |
| rpl_recovery_rank                                 | 0                                                                                                                      |
| secure_auth                                       | OFF                                                                                                                    |
| secure_file_priv                                  |                                                                                                                        |
| server_id                                         | 1                                                                                                                      |
| skip_external_locking                             | ON                                                                                                                     |
| skip_name_resolve                                 | ON                                                                                                                     |
| skip_networking                                   | OFF                                                                                                                    |
| skip_show_database                                | OFF                                                                                                                    |
| slave_compressed_protocol                         | OFF                                                                                                                    |
| slave_exec_mode                                   | STRICT                                                                                                                 |
| slave_load_tmpdir                                 | /tmp                                                                                                                   |
| slave_net_timeout                                 | 3600                                                                                                                   |
| slave_skip_errors                                 | OFF                                                                                                                    |
| slave_transaction_retries                         | 10                                                                                                                     |
| slave_type_conversions                            |                                                                                                                        |
| slow_launch_time                                  | 2                                                                                                                      |
| slow_query_log                                    | OFF                                                                                                                    |
| slow_query_log_file                               | /home/mysql/data/csmp-db2-slow.log                                                                                     |
| socket                                            | /tmp/mysql.sock                                                                                                        |
| sort_buffer_size                                  | 1048576                                                                                                                |
| sql_auto_is_null                                  | OFF                                                                                                                    |
| sql_big_selects                                   | ON                                                                                                                     |
| sql_big_tables                                    | OFF                                                                                                                    |
| sql_buffer_result                                 | OFF                                                                                                                    |
| sql_log_bin                                       | ON                                                                                                                     |
| sql_log_off                                       | OFF                                                                                                                    |
| sql_low_priority_updates                          | OFF                                                                                                                    |
| sql_max_join_size                                 | 18446744073709551615                                                                                                   |
| sql_mode                                          |                                                                                                                        |
| sql_notes                                         | ON                                                                                                                     |
| sql_quote_show_create                             | ON                                                                                                                     |
| sql_safe_updates                                  | OFF                                                                                                                    |
| sql_select_limit                                  | 18446744073709551615                                                                                                   |
| sql_slave_skip_counter                            | 0                                                                                                                      |
| sql_warnings                                      | OFF                                                                                                                    |
| ssl_ca                                            |                                                                                                                        |
| ssl_capath                                        |                                                                                                                        |
| ssl_cert                                          |                                                                                                                        |
| ssl_cipher                                        |                                                                                                                        |
| ssl_key                                           |                                                                                                                        |
| storage_engine                                    | InnoDB                                                                                                                 |
| sync_binlog                                       | 0                                                                                                                      |
| sync_frm                                          | ON                                                                                                                     |
| sync_master_info                                  | 0                                                                                                                      |
| sync_relay_log                                    | 0                                                                                                                      |
| sync_relay_log_info                               | 0                                                                                                                      |
| system_time_zone                                  | CST                                                                                                                    |
| table_definition_cache                            | 400                                                                                                                    |
| table_open_cache                                  | 256                                                                                                                    |
| thread_cache_size                                 | 8                                                                                                                      |
| thread_concurrency                                | 32                                                                                                                     |
| thread_handling                                   | one-thread-per-connection                                                                                              |
| thread_stack                                      | 262144                                                                                                                 |
| time_format                                       | %H:%i:%s                                                                                                               |
| time_zone                                         | SYSTEM                                                                                                                 |
| timed_mutexes                                     | OFF                                                                                                                    |
| timestamp                                         | 1529554139                                                                                                             |
| tmp_table_size                                    | 209715200                                                                                                              |
| tmpdir                                            | /tmp                                                                                                                   |
| transaction_alloc_block_size                      | 8192                                                                                                                   |
| transaction_prealloc_size                         | 4096                                                                                                                   |
| tx_isolation                                      | REPEATABLE-READ                                                                                                        |
| unique_checks                                     | ON                                                                                                                     |
| updatable_views_with_limit                        | YES                                                                                                                    |
| version                                           | 5.5.11-log                                                                                                             |
| version_comment                                   | Source distribution                                                                                                    |
| version_compile_machine                           | x86_64                                                                                                                 |
| version_compile_os                                | Linux                                                                                                                  |
| wait_timeout                                      | 28800                                                                                                                  |
| warning_count                                     | 0                                                                                                                      |
+---------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
321 rows in set (0.01 sec)

```

#### 一、慢查询 

  配置中打开了记录慢查询，执行时间超过2秒的即为慢查询，系统显示有6848个慢查询 

```
mysql> show variables like '%slow%'; 
+---------------------+------------------------------------+
| Variable_name       | Value                              |
+---------------------+------------------------------------+
| log_slow_queries    | OFF                                |
| slow_launch_time    | 2                                  |
| slow_query_log      | OFF                                |
| slow_query_log_file | /home/mysql/data/csmp-db2-slow.log |
+---------------------+------------------------------------+
4 rows in set (0.00 sec)

mysql> show global status like '%slow%';
+---------------------+-------+
| Variable_name       | Value |
+---------------------+-------+
| Slow_launch_threads | 0     |
| Slow_queries        | 6848  |
+---------------------+-------+
2 rows in set (0.00 sec)
```

#### **二、连接数**  

经常会遇见”MySQL: ERROR 1040: Too many connections”的情况，一种是访问量确实很高，MySQL服务器抗不住，这个时候就要考虑增加从服务器分散读压力，另外一种情况是MySQL配置文件中max_connections值过小： 

```
mysql> show variables like 'max_connections'; 
+-----------------+-------+
| Variable_name   | Value |
+-----------------+-------+
| max_connections | 1000  |
+-----------------+-------+
1 row in set (0.00 sec)
```

​       这台MySQL服务器最大连接数是1000，然后查询一下服务器响应的最大连接数： 

```
mysql> show global status like 'Max_used_connections';
+----------------------+-------+
| Variable_name        | Value |
+----------------------+-------+
| Max_used_connections | 261   |
+----------------------+-------+
1 row in set (0.00 sec)
```


　　MySQL服务器过去的最大连接数是261，没有达到服务器连接数上限261，应该没有出现1040错误，比较理想的设置是：
　　Max_used_connections / max_connections * 100% ≈ 85%
　　最大连接数占上限连接数的85%左右，如果发现比例在10%以下，MySQL服务器连接数上限设置的过高了。

#### **三、Key_buffer_size** 

​       key_buffer_size是对MyISAM表性能影响最大的一个参数，下面一台以MyISAM为主要存储引擎服务器的配置： 

```
mysql> show variables like 'key_buffer_size';  
+-----------------+-----------+
| Variable_name   | Value     |
+-----------------+-----------+
| key_buffer_size | 536870912 |
+-----------------+-----------+
1 row in set (0.00 sec)
```

分配了512MB内存给key_buffer_size，我们再看一下key_buffer_size的使用情况：  

```
mysql> show global status like 'key_read%'; 
+-------------------+-------------+
| Variable_name     | Value       |
+-------------------+-------------+
| Key_read_requests | 22863254879 |
| Key_reads         | 17621377    |
+-------------------+-------------+
2 rows in set (0.00 sec)
```

一共有22863254879个索引读取请求，有17621377个请求在内存中没有找到直接从硬盘读取索引，计算索引未命中缓存的概率： 　　key_cache_miss_rate = Key_reads / Key_read_requests * 100%

比如上面的数据，key_cache_miss_rate为0.077%，4000个索引读取请求才有一个直接读硬盘，已经很BT了,key_cache_miss_rate在0.1%以下都很好(每1000个请求有一个直接读硬盘)



#### **四、临时表** 

```
mysql> show global status like 'created_tmp%'; 
+-------------------------+---------+
| Variable_name           | Value   |
+-------------------------+---------+
| Created_tmp_disk_tables | 59134   |
| Created_tmp_files       | 58823   |
| Created_tmp_tables      | 2361602 |
+-------------------------+---------+
3 rows in set (0.00 sec)　　
```

​       每次创建临时表，Created_tmp_tables增加，如果是在磁盘上创建临时表，Created_tmp_disk_tables也增加,Created_tmp_files表示MySQL服务创建的临时文件文件数，比较理想的配置是：
　　Created_tmp_disk_tables / Created_tmp_tables * 100% <= 25% 
　　比如上面的服务器Created_tmp_disk_tables / Created_tmp_tables * 100% = 2.50%，应该相当好了。我们再看一下MySQL服务器对临时表的配置： 

```
mysql> show variables where Variable_name in ('tmp_table_size', 'max_heap_table_size'); 
+---------------------+-----------+
| Variable_name       | Value     |
+---------------------+-----------+
| max_heap_table_size | 536870912 |
| tmp_table_size      | 209715200 |
+---------------------+-----------+
2 rows in set (0.00 sec)　
```

​      只有512MB以下的临时表才能全部放内存，超过的就会用到硬盘临时表。

#### **五、Open Table情况** 

```
mysql> show global status like 'open%tables%'; 
+---------------+--------+
| Variable_name | Value  |
+---------------+--------+
| Open_tables   | 256    |
| Opened_tables | 161840 |
+---------------+--------+
2 rows in set (0.00 sec)　
```

​      Open_tables表示打开表的数量，Opened_tables表示打开过的表数量，如果Opened_tables数量过大，说明配置中table_cache(5.1.3之后这个值叫做table_open_cache)值可能太小，我们查询一下服务器table_cache值： 
　

```
mysql> show variables like 'table_cache'; 
Empty set (0.00 sec)
```

​       **发现没有设置该值。**
　　比较合适的值为： 
　　Open_tables / Opened_tables * 100% >= 85%，上述结果为15%
　　Open_tables / table_cache * 100% <= 95%

#### **六、进程使用情况**　　

​     

```
mysql> show global status like 'Thread%'; 
+-------------------+-------+
| Variable_name     | Value |
+-------------------+-------+
| Threads_cached    | 4     |
| Threads_connected | 61    |
| Threads_created   | 14165 |
| Threads_running   | 1     |
+-------------------+-------+
4 rows in set (0.00 sec)　
```

​      如果我们在MySQL服务器配置文件中设置了thread_cache_size，当客户端断开之后，服务器处理此客户的线程将会缓存起来以响应下一个客户而不是销毁(前提是缓存数未达上限)。Threads_created表示创建过的线程数，如果发现Threads_created值过大的话，表明MySQL服务器一直在创建线程，这也是比较耗资源，可以适当增加配置文件中thread_cache_size值，查询服务器thread_cache_size配置： 

```
mysql> show variables like 'thread_cache_size'; 
+-------------------+-------+
| Variable_name     | Value |
+-------------------+-------+
| thread_cache_size | 8     |
+-------------------+-------+
1 row in set (0.00 sec)　
```

​     **发现Threads_created的值过大，而thread_cache_size的值过小**

#### **七、查询缓存(query cache)** 

```
 mysql> show global status like 'qcache%'; 
+-------------------------+------------+
| Variable_name           | Value      |
+-------------------------+------------+
| Qcache_free_blocks      | 1134       |
| Qcache_free_memory      | 3915256    |
| Qcache_hits             | 277805303  |
| Qcache_inserts          | 2769839408 |
| Qcache_lowmem_prunes    | 2713461033 |
| Qcache_not_cached       | 363278962  |
| Qcache_queries_in_cache | 6959       |
| Qcache_total_blocks     | 15188      |
+-------------------------+------------+
8 rows in set (0.00 sec)　
```

​       MySQL查询缓存变量解释：
　　Qcache_free_blocks：缓存中相邻内存块的个数。数目大说明可能有碎片。FLUSH QUERY CACHE会对缓存中的碎片进行整理，从而得到一个空闲块。
　　Qcache_free_memory：缓存中的空闲内存。 
　　Qcache_hits：每次查询在缓存中命中时就增大
　　Qcache_inserts：每次插入一个查询时就增大。命中次数除以插入次数就是不中比率。
　　Qcache_lowmem_prunes：缓存出现内存不足并且必须要进行清理以便为更多查询提供空间的次数。这个数字最好长时间来看;如果这个数字在不断增长，就表示可能碎片非常严重，或者内存很少。(上面的 free_blocks和free_memory可以告诉您属于哪种情况) 
　　Qcache_not_cached：不适合进行缓存的查询的数量，通常是由于这些查询不是 SELECT 语句或者用了now()之类的函数。
　　Qcache_queries_in_cache：当前缓存的查询(和响应)的数量。
　　Qcache_total_blocks：缓存中块的数量。
　　我们再查询一下服务器关于query_cache的配置： 
　

```
　mysql> show variables like 'query_cache%';
+------------------------------+----------+
| Variable_name                | Value    |
+------------------------------+----------+
| query_cache_limit            | 10485760 |
| query_cache_min_res_unit     | 4096     |
| query_cache_size             | 16777216 |
| query_cache_type             | ON       |
| query_cache_wlock_invalidate | OFF      |
+------------------------------+----------+
5 rows in set (0.01 sec)
```